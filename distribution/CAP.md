# CAP 定理

[CAP](https://en.wikipedia.org/wiki/CAP_theorem) 定理是分布式系统设计中最基础，也是最为关键的理论。它指出，分布式数据存储不可能同时满足以下三个条件：

  - **一致性（Consistency）**：每次读取要么获得最近写入的数据，要么获得一个错误
  - **可用性（Availability）**：每次请求都能获得一个（非错误）响应，但不保证返回的是最新写入的数据。
  - **分区容忍（Partition tolerance）**：尽管任意数量的消息被节点间的网络丢失（或延迟），系统仍继续运行。

根据定理，分布式系统只能满足三项中的两项而不可能满足全部三项。理解 CAP 理论的最简单方式是想象两个节点分处分区两侧。允许至少一个节点更新状态会导致数据不一致，即丧失了 C 性质。如果为了保证数据一致性，将分区一侧的节点设置为不可用，那么又丧失了 A 性质。除非两个节点可以互相通信，才能既保证 C 又保证 A，这又会导致丧失P性质。

![](https://github.com/taojintianxia/jargon/blob/master/resources/img/distribution/cap/Teorema-CAP-2.png)

> 需要注意的的是，CAP 理论中的 CA 和数据库事务中 ACID 的 CA 并完全是同一回事儿。两者之中的 C 都是一致性(Consistency)。CAP 中的 A 指的是可用性（Availability），而 ACID 中的 A 指的是原子性（Atomicity)

## Consistency 和 Availability 的矛盾

一致性和可用性，为什么不可能同时成立？答案很简单，因为可能通信失败（即出现分区容错）。



## 历史

这个定理起源于加州大学柏克莱分校（University of California, Berkeley）的计算机科学家埃里克·布鲁尔在2000年的分布式计算原理研讨会（PODC）上提出的一个猜想。在2002年，麻省理工学院（MIT）的赛斯·吉尔伯特和南希·林奇发表了布鲁尔猜想的证明，使之成为一个定理。

CAP 理论最早在 1998 年秋季提出，1999 年正式发表

吉尔伯特和林奇证明的 CAP 定理比布鲁尔设想的某种程度上更加狭义。定理讨论了在两个互相矛盾的请求到达彼此连接不通的两个不同的分布式节点的时候的处理方案。


